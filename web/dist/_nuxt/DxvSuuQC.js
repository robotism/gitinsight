import{i as N}from"./CsnUGP09.js";import{e as Y,f as H,r as i,g as R,h as _,i as x,j as S,c as O,o as C,k as T,a as q,b as m,l as g}from"#entry";import{_ as E}from"./DlAUqK2U.js";import{h as V}from"./BLMuvzoS.js";import{u as G}from"./CcM062yI.js";const K=()=>({hashColor:d=>{let c=0;for(let f=0;f<d.length;f++)c=d.charCodeAt(f)+((c<<5)-c);return`hsl(${Math.abs(c)%360}, 70%, 55%)`},rankColor:(d,c)=>{const h=["#FFB300","#FFC107","#FFD700"],f="#60A5FA",e=["#FF7043","#F44336","#D32F2F"];return d<3?h[d]:c>0&&d>=c-3?e[d-(c-3)]:f}}),J={__name:"AynalisisProjectsCard",props:{title:{type:String},projects:{type:Array,required:!0},metric:{type:String,default:"effectives"}},setup($){const a=Y(),{size:d}=H(),{hashColor:c}=K(),h=$,f=i(null),e=i(null),v=R(()=>(h.projects||[]).map(o=>({repoBranch:((o.repoUrl||"")?.split("/").pop().replace(".git","")||o.repoUrl)+"/"+o.branchName,...o}))),b=R(()=>{const o=[...v.value],n=h.metric;return o.sort((s,p)=>(p[n]||0)-(s[n]||0))}),k=R(()=>{const o=h.metric,n=a.t(o);return{title:{text:`${h.title}`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:100,right:40,top:60,bottom:30},xAxis:{type:"value",axisLabel:{formatter:"{value}"}},yAxis:{type:"category",inverse:!0,data:b.value.map(s=>s.repoBranch),axisLabel:{fontSize:8}},series:[{name:n,type:"bar",data:b.value.map(s=>s[o]),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:s=>c(s.name||s.data.repoUrl+"/"+s.data.branchName)},barMaxWidth:25}]}});return _(()=>d.value,(o,n)=>{n.width==0||n.height==0||e.value&&!e.value.isDisposed()&&e.value.getOption()&&e.value.resize()},{deep:!0}),_(k,o=>{e.value&&e.value.setOption(o,!0)}),x(()=>{e.value=N(f.value),e.value.setOption(k.value)}),S(()=>{e.value&&e.value.dispose()}),(o,n)=>(C(),O("div",{ref_key:"chartRef",ref:f,class:"w-[360px] h-[270px]"},null,512))}},j=E(J,[["__scopeId","data-v-e8c7e079"]]),Q=T({__name:"RankingCard",props:{title:{type:String},metric:{type:String,default:"effectives"},ranking:{type:Array,default:[]}},setup($){const a=Y(),{size:d}=H(),{rankColor:c}=K(),h=$,f=i(null),e=i(null),v=R(()=>h.metric),b=R(()=>a.t(v.value)),k=R(()=>{const n=[...h.ranking||[]],s=v.value;return n.sort((p,y)=>(y[s]||0)-(p[s]||0)).slice(0,10)}),o=R(()=>({title:{text:h.title,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:n=>{const s=n[0],p=k.value[s.dataIndex]||{};return`
          <div>
            <strong>${p.nickname}</strong><br/>
            ${a.t("commits")}: ${p.commits}<br/>
            ${a.t("additions")}: <span style="color:green">${p.additions}</span><br/>
            ${a.t("deletions")}: <span style="color:red">${p.deletions}</span><br/>
            ${a.t("effectives")}: <span style="color:teal">${p.effectives}</span>
          </div>`}},grid:{left:100,right:40,top:80,bottom:40},xAxis:{type:"value",axisLabel:{fontSize:13}},yAxis:{type:"category",inverse:!0,axisLabel:{fontSize:10},data:k.value.map(n=>n.nickname||"")},series:[{name:b.value,type:"bar",barMaxWidth:25,data:k.value.map(n=>n[v.value]||0),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:n=>c(n.dataIndex,k.value.length)}}]}));return _(()=>d.value,()=>{e.value&&!e.value.isDisposed()&&e.value.resize()},{deep:!0}),_(o,n=>{e.value&&e.value.setOption(n,!0)}),x(async()=>{e.value=N(f.value),e.value.setOption(o.value)}),S(()=>{e.value?.dispose()}),(n,s)=>(C(),O("div",{ref_key:"chartRef",ref:f,class:"w-[360px] h-[270px]"},null,512))}}),w=Object.assign(Q,{__name:"AynalisisRankingCard"}),X=globalThis.setInterval,Z={class:"w-full content-center"},tt={class:"max-w-[1600px] flex flex-row content-center"},rt={__name:"index",setup($){const a=G(),d=i([]),c=i([]),h=i([]),f=i([]),e=i([]),v=i([]),b=i([]),k=i([]),o=i([]),n=i([]),s=i([]),p=i([]);function y(r){const l="YYYY-MM-DD HH:mm:ss",u=V();switch(r){case"today":return[u.startOf("day").format(l),u.endOf("day").format(l)];case"yesterday":return[u.clone().subtract(1,"day").startOf("day").format(l),u.clone().subtract(1,"day").endOf("day").format(l)];case"week":return[u.startOf("week").format(l),u.endOf("week").format(l)];case"lastWeek":return[u.clone().subtract(1,"week").startOf("week").format(l),u.clone().subtract(1,"week").endOf("week").format(l)];case"month":return[u.startOf("month").format(l),u.endOf("month").format(l)];case"lastMonth":return[u.clone().subtract(1,"month").startOf("month").format(l),u.clone().subtract(1,"month").endOf("month").format(l)];default:return[]}}const P=()=>{const[r,l]=y("today"),[u,A]=y("yesterday"),[B,F]=y("week"),[W,U]=y("lastWeek"),[z,D]=y("month"),[I,L]=y("lastMonth");a.getRepoBranches({since:r,until:l}).then(t=>{t.code===200&&(d.value=t.data)}),a.getRanking({since:r,until:l}).then(t=>{t.code===200&&(c.value=t.data)}),a.getRepoBranches({since:u,until:A}).then(t=>{t.code===200&&(h.value=t.data)}),a.getRanking({since:u,until:A}).then(t=>{t.code===200&&(f.value=t.data)}),a.getRepoBranches({since:B,until:F}).then(t=>{t.code===200&&(e.value=t.data)}),a.getRanking({since:B,until:F}).then(t=>{t.code===200&&(v.value=t.data)}),a.getRepoBranches({since:W,until:U}).then(t=>{t.code===200&&(b.value=t.data)}),a.getRanking({since:W,until:U}).then(t=>{t.code===200&&(k.value=t.data)}),a.getRepoBranches({since:z,until:D}).then(t=>{t.code===200&&(o.value=t.data)}),a.getRanking({since:z,until:D}).then(t=>{t.code===200&&(n.value=t.data)}),a.getRepoBranches({since:I,until:L}).then(t=>{t.code===200&&(s.value=t.data)}),a.getRanking({since:I,until:L}).then(t=>{t.code===200&&(p.value=t.data)})},M=i(null);return x(()=>{P(),M.value=X(()=>{P()},3e4)}),S(()=>{clearInterval(M.value)}),(r,l)=>(C(),O("div",Z,[q("div",tt,[m(j,{title:r.$t("dashboard.todayProjects"),projects:g(d)},null,8,["title","projects"]),m(w,{title:r.$t("dashboard.todayRanking"),ranking:g(c)},null,8,["title","ranking"]),m(j,{title:r.$t("dashboard.yesterdayProjects"),projects:g(h)},null,8,["title","projects"]),m(w,{title:r.$t("dashboard.yesterdayRanking"),ranking:g(f)},null,8,["title","ranking"]),m(j,{title:r.$t("dashboard.weekProjects"),projects:g(e)},null,8,["title","projects"]),m(w,{title:r.$t("dashboard.weekRanking"),ranking:g(v)},null,8,["title","ranking"]),m(j,{title:r.$t("dashboard.lastWeekProjects"),projects:g(b)},null,8,["title","projects"]),m(w,{title:r.$t("dashboard.lastWeekRanking"),ranking:g(k)},null,8,["title","ranking"]),m(j,{title:r.$t("dashboard.monthProjects"),projects:g(o)},null,8,["title","projects"]),m(w,{title:r.$t("dashboard.monthRanking"),ranking:g(n)},null,8,["title","ranking"]),m(j,{title:r.$t("dashboard.lastMonthProjects"),projects:g(s)},null,8,["title","projects"]),m(w,{title:r.$t("dashboard.lastMonthRanking"),ranking:g(p)},null,8,["title","ranking"])])]))}};export{rt as default};
