import{_ as L,u as H,s as K}from"./BHX9svgu.js";import{e as D,f as k,g as N,o as P,h as c,i as E,r as d,j as T,k as G,c as J,a as S,b as u,l as Q,_ as X,n as m,F as Z}from"#entry";import{u as Y}from"./BkIceAGO.js";import{_ as F}from"./DlAUqK2U.js";import{h as tt}from"./BLMuvzoS.js";const et={__name:"AynalisisProjectsCard",props:{title:{type:String},projects:{type:Array,required:!0},metric:{type:String,default:"effectives"}},setup(R){const a=D(),{hashColor:y}=Y(),p=R,g=k(()=>(p.projects||[]).map(l=>({repoBranch:((l.repoUrl||"")?.split("/").pop().replace(".git","")||l.repoUrl)+"/"+l.branchName,...l}))),h=k(()=>{const l=[...g.value],s=p.metric;return l.sort((n,i)=>(i[s]||0)-(n[s]||0))}),f=k(()=>{const l=p.metric,s=a.t(l);return{title:{text:`${p.title}`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:100,right:40,top:60,bottom:30},xAxis:{type:"value",axisLabel:{formatter:"{value}"}},yAxis:{type:"category",inverse:!0,data:h.value.map(n=>n.repoBranch),axisLabel:{fontSize:8}},series:[{name:s,type:"bar",data:h.value.map(n=>n[l]),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:n=>y(n.name||n.data.repoUrl+"/"+n.data.branchName)},barMaxWidth:25}]}});return(l,s)=>{const n=L;return P(),N(n,{option:c(f),autoresize:""},null,8,["option"])}}},v=F(et,[["__scopeId","data-v-193d53b2"]]),at=E({__name:"RankingCard",props:{title:{type:String},metric:{type:String,default:"effectives"},ranking:{type:Array,default:[]}},setup(R){const a=D(),{rankColor:y}=Y(),p=R,g=k(()=>p.metric),h=k(()=>a.t(g.value)),f=k(()=>{const s=[...p.ranking||[]],n=g.value;return s.sort((i,j)=>(j[n]||0)-(i[n]||0)).slice(0,10)}),l=k(()=>({title:{text:p.title,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:s=>{const n=s[0],i=f.value[n.dataIndex]||{};return`
          <div>
            <strong>${i.nickname}</strong><br/>
            ${a.t("commits")}: ${i.commits}<br/>
            ${a.t("additions")}: <span style="color:green">${i.additions}</span><br/>
            ${a.t("deletions")}: <span style="color:red">${i.deletions}</span><br/>
            ${a.t("effectives")}: <span style="color:teal">${i.effectives}</span>
          </div>`}},grid:{left:100,right:40,top:80,bottom:40},xAxis:{type:"value",axisLabel:{fontSize:13}},yAxis:{type:"category",inverse:!0,axisLabel:{fontSize:10},data:f.value.map(s=>s.nickname||"")},series:[{name:h.value,type:"bar",barMaxWidth:25,data:f.value.map(s=>s[g.value]||0),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:s=>y(s.dataIndex,f.value.length)}}]}));return(s,n)=>{const i=L;return P(),N(i,{option:c(l),autoresize:""},null,8,["option"])}}}),$=Object.assign(at,{__name:"AynalisisRankingCard"}),nt={class:"w-full h-full flex flex-col justify-center items-center p-4"},st={class:"w-full content-center"},ot={class:"max-w-[1600px] flex flex-row content-center"},rt={__name:"index",setup(R){const a=H(),y=d([]),p=d([]),g=d([]),h=d([]),f=d([]),l=d([]),s=d([]),n=d([]),i=d([]),j=d([]),q=d([]),x=d([]);function b(e){const o="YYYY-MM-DD HH:mm:ss",r=tt();switch(e){case"today":return[r.startOf("day").format(o),r.endOf("day").format(o)];case"yesterday":return[r.clone().subtract(1,"day").startOf("day").format(o),r.clone().subtract(1,"day").endOf("day").format(o)];case"week":return[r.startOf("week").format(o),r.endOf("week").format(o)];case"lastWeek":return[r.clone().subtract(1,"week").startOf("week").format(o),r.clone().subtract(1,"week").endOf("week").format(o)];case"month":return[r.startOf("month").format(o),r.endOf("month").format(o)];case"lastMonth":return[r.clone().subtract(1,"month").startOf("month").format(o),r.clone().subtract(1,"month").endOf("month").format(o)];default:return[]}}const M=()=>{const[e,o]=b("today"),[r,w]=b("yesterday"),[B,C]=b("week"),[W,U]=b("lastWeek"),[A,z]=b("month"),[I,V]=b("lastMonth");a.getRepoBranches({since:e,until:o}).then(t=>{t.code===200&&(y.value=t.data)}),a.getRanking({since:e,until:o}).then(t=>{t.code===200&&(p.value=t.data)}),a.getRepoBranches({since:r,until:w}).then(t=>{t.code===200&&(g.value=t.data)}),a.getRanking({since:r,until:w}).then(t=>{t.code===200&&(h.value=t.data)}),a.getRepoBranches({since:B,until:C}).then(t=>{t.code===200&&(f.value=t.data)}),a.getRanking({since:B,until:C}).then(t=>{t.code===200&&(l.value=t.data)}),a.getRepoBranches({since:W,until:U}).then(t=>{t.code===200&&(s.value=t.data)}),a.getRanking({since:W,until:U}).then(t=>{t.code===200&&(n.value=t.data)}),a.getRepoBranches({since:A,until:z}).then(t=>{t.code===200&&(i.value=t.data)}),a.getRanking({since:A,until:z}).then(t=>{t.code===200&&(j.value=t.data)}),a.getRepoBranches({since:I,until:V}).then(t=>{t.code===200&&(q.value=t.data)}),a.getRanking({since:I,until:V}).then(t=>{t.code===200&&(x.value=t.data)})},O=d(),_=d(!0);return T(()=>{M(),O.value=K(()=>{_.value&&M()},3e4)}),G(()=>{clearInterval(O.value)}),(e,o)=>{const r=X;return P(),J(Z,null,[S("div",nt,[u(r,{class:"text-xs ml-auto mr-32",dense:"",modelValue:c(_),"onUpdate:modelValue":o[0]||(o[0]=w=>Q(_)?_.value=w:null),label:e.$t("autoRefresh")},null,8,["modelValue","label"])]),S("div",st,[S("div",ot,[u(v,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.todayProjects"),projects:c(y)},null,8,["class","title","projects"]),u($,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.todayRanking"),ranking:c(p)},null,8,["class","title","ranking"]),u(v,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.yesterdayProjects"),projects:c(g)},null,8,["class","title","projects"]),u($,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.yesterdayRanking"),ranking:c(h)},null,8,["class","title","ranking"]),u(v,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.weekProjects"),projects:c(f)},null,8,["class","title","projects"]),u($,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.weekRanking"),ranking:c(l)},null,8,["class","title","ranking"]),u(v,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.lastWeekProjects"),projects:c(s)},null,8,["class","title","projects"]),u($,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.lastWeekRanking"),ranking:c(n)},null,8,["class","title","ranking"]),u(v,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.monthProjects"),projects:c(i)},null,8,["class","title","projects"]),u($,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.monthRanking"),ranking:c(j)},null,8,["class","title","ranking"]),u(v,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.lastMonthProjects"),projects:c(q)},null,8,["class","title","projects"]),u($,{class:m(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.lastMonthRanking"),ranking:c(x)},null,8,["class","title","ranking"])])])],64)}}},mt=F(rt,[["__scopeId","data-v-3ce3c3e9"]]);export{mt as default};
