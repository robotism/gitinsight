import{_ as I,u as V}from"./C3mEb5f8.js";import{e as x,f as y,g as D,o as w,h as u,i as Y,r as h,j as H,k as K,c as T,a as E,b as g,n as p}from"#entry";import{_ as L}from"./DlAUqK2U.js";import{h as G}from"./BLMuvzoS.js";const N=()=>({hashColor:i=>{let n=0;for(let m=0;m<i.length;m++)n=i.charCodeAt(m)+((n<<5)-n);return`hsl(${Math.abs(n)%360}, 70%, 55%)`},rankColor:(i,n)=>{const f=["#FFB300","#FFC107","#FFD700"],m="#60A5FA",k=["#FF7043","#F44336","#D32F2F"];return i<3?f[i]:n>0&&i>=n-3?k[i-(n-3)]:m}}),J={__name:"AynalisisProjectsCard",props:{title:{type:String},projects:{type:Array,required:!0},metric:{type:String,default:"effectives"}},setup(j){const a=x(),{hashColor:i}=N(),n=j,f=y(()=>(n.projects||[]).map(c=>({repoBranch:((c.repoUrl||"")?.split("/").pop().replace(".git","")||c.repoUrl)+"/"+c.branchName,...c}))),m=y(()=>{const c=[...f.value],o=n.metric;return c.sort((s,d)=>(d[o]||0)-(s[o]||0))}),k=y(()=>{const c=n.metric,o=a.t(c);return{title:{text:`${n.title}`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:100,right:40,top:60,bottom:30},xAxis:{type:"value",axisLabel:{formatter:"{value}"}},yAxis:{type:"category",inverse:!0,data:m.value.map(s=>s.repoBranch),axisLabel:{fontSize:8}},series:[{name:o,type:"bar",data:m.value.map(s=>s[c]),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:s=>i(s.name||s.data.repoUrl+"/"+s.data.branchName)},barMaxWidth:25}]}});return(c,o)=>{const s=I;return w(),D(s,{option:u(k),autoresize:""},null,8,["option"])}}},v=L(J,[["__scopeId","data-v-193d53b2"]]),Q=Y({__name:"RankingCard",props:{title:{type:String},metric:{type:String,default:"effectives"},ranking:{type:Array,default:[]}},setup(j){const a=x(),{rankColor:i}=N(),n=j,f=y(()=>n.metric),m=y(()=>a.t(f.value)),k=y(()=>{const o=[...n.ranking||[]],s=f.value;return o.sort((d,R)=>(R[s]||0)-(d[s]||0)).slice(0,10)}),c=y(()=>({title:{text:n.title,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:o=>{const s=o[0],d=k.value[s.dataIndex]||{};return`
          <div>
            <strong>${d.nickname}</strong><br/>
            ${a.t("commits")}: ${d.commits}<br/>
            ${a.t("additions")}: <span style="color:green">${d.additions}</span><br/>
            ${a.t("deletions")}: <span style="color:red">${d.deletions}</span><br/>
            ${a.t("effectives")}: <span style="color:teal">${d.effectives}</span>
          </div>`}},grid:{left:100,right:40,top:80,bottom:40},xAxis:{type:"value",axisLabel:{fontSize:13}},yAxis:{type:"category",inverse:!0,axisLabel:{fontSize:10},data:k.value.map(o=>o.nickname||"")},series:[{name:m.value,type:"bar",barMaxWidth:25,data:k.value.map(o=>o[f.value]||0),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:o=>i(o.dataIndex,k.value.length)}}]}));return(o,s)=>{const d=I;return w(),D(d,{option:u(c),autoresize:""},null,8,["option"])}}}),$=Object.assign(Q,{__name:"AynalisisRankingCard"}),X=globalThis.setInterval,Z={class:"w-full content-center"},tt={class:"max-w-[1600px] flex flex-row content-center"},et={__name:"index",setup(j){const a=V(),i=h([]),n=h([]),f=h([]),m=h([]),k=h([]),c=h([]),o=h([]),s=h([]),d=h([]),R=h([]),S=h([]),C=h([]);function b(e){const r="YYYY-MM-DD HH:mm:ss",l=G();switch(e){case"today":return[l.startOf("day").format(r),l.endOf("day").format(r)];case"yesterday":return[l.clone().subtract(1,"day").startOf("day").format(r),l.clone().subtract(1,"day").endOf("day").format(r)];case"week":return[l.startOf("week").format(r),l.endOf("week").format(r)];case"lastWeek":return[l.clone().subtract(1,"week").startOf("week").format(r),l.clone().subtract(1,"week").endOf("week").format(r)];case"month":return[l.startOf("month").format(r),l.endOf("month").format(r)];case"lastMonth":return[l.clone().subtract(1,"month").startOf("month").format(r),l.clone().subtract(1,"month").endOf("month").format(r)];default:return[]}}const _=()=>{const[e,r]=b("today"),[l,M]=b("yesterday"),[B,O]=b("week"),[q,A]=b("lastWeek"),[F,W]=b("month"),[U,z]=b("lastMonth");a.getRepoBranches({since:e,until:r}).then(t=>{t.code===200&&(i.value=t.data)}),a.getRanking({since:e,until:r}).then(t=>{t.code===200&&(n.value=t.data)}),a.getRepoBranches({since:l,until:M}).then(t=>{t.code===200&&(f.value=t.data)}),a.getRanking({since:l,until:M}).then(t=>{t.code===200&&(m.value=t.data)}),a.getRepoBranches({since:B,until:O}).then(t=>{t.code===200&&(k.value=t.data)}),a.getRanking({since:B,until:O}).then(t=>{t.code===200&&(c.value=t.data)}),a.getRepoBranches({since:q,until:A}).then(t=>{t.code===200&&(o.value=t.data)}),a.getRanking({since:q,until:A}).then(t=>{t.code===200&&(s.value=t.data)}),a.getRepoBranches({since:F,until:W}).then(t=>{t.code===200&&(d.value=t.data)}),a.getRanking({since:F,until:W}).then(t=>{t.code===200&&(R.value=t.data)}),a.getRepoBranches({since:U,until:z}).then(t=>{t.code===200&&(S.value=t.data)}),a.getRanking({since:U,until:z}).then(t=>{t.code===200&&(C.value=t.data)})},P=h(null);return H(()=>{_(),P.value=X(()=>{_()},3e4)}),K(()=>{clearInterval(P.value)}),(e,r)=>(w(),T("div",Z,[E("div",tt,[g(v,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.todayProjects"),projects:u(i)},null,8,["class","title","projects"]),g($,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.todayRanking"),ranking:u(n)},null,8,["class","title","ranking"]),g(v,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.yesterdayProjects"),projects:u(f)},null,8,["class","title","projects"]),g($,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.yesterdayRanking"),ranking:u(m)},null,8,["class","title","ranking"]),g(v,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.weekProjects"),projects:u(k)},null,8,["class","title","projects"]),g($,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.weekRanking"),ranking:u(c)},null,8,["class","title","ranking"]),g(v,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.lastWeekProjects"),projects:u(o)},null,8,["class","title","projects"]),g($,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.lastWeekRanking"),ranking:u(s)},null,8,["class","title","ranking"]),g(v,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.monthProjects"),projects:u(d)},null,8,["class","title","projects"]),g($,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.monthRanking"),ranking:u(R)},null,8,["class","title","ranking"]),g(v,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.lastMonthProjects"),projects:u(S)},null,8,["class","title","projects"]),g($,{class:p(e.$q.screen.gt.md?"card":"card-mobile"),title:e.$t("dashboard.lastMonthRanking"),ranking:u(C)},null,8,["class","title","ranking"])])]))}},rt=L(et,[["__scopeId","data-v-42f8082f"]]);export{rt as default};
