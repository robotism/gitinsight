import{_ as L,u as K,s as E}from"./BT3DorMk.js";import{e as D,f as y,g as N,o as x,h as i,i as T,r as d,j as G,k as H,c as J,a as S,b as u,l as Q,_ as X,n as m,F as Z}from"#entry";import{u as Y}from"./BkIceAGO.js";import{_ as F}from"./DlAUqK2U.js";import{h as tt}from"./BLMuvzoS.js";const et={__name:"AynalisisProjectsCard",props:{title:{type:String},projects:{type:Array,required:!0},metric:{type:String,default:"effectives"}},setup(j){const n=D(),{hashColor:b}=Y(),f=j,g=y(()=>(f.projects||[]).map(l=>({repoBranch:((l.repoUrl||"")?.split("/").pop().replace(".git","")||l.repoUrl)+"/"+l.branchName,...l}))),k=y(()=>{const l=[...g.value],o=f.metric;return l.sort((a,s)=>(s[o]||0)-(a[o]||0))}),p=y(()=>{const l=f.metric,o=n.t(l);return{title:{text:`${f.title}`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:100,right:40,top:60,bottom:30},xAxis:{type:"value",axisLabel:{formatter:"{value}"}},yAxis:{type:"category",inverse:!0,data:k.value.map(a=>a.repoBranch).map(a=>{try{const s="/cherry-pick-";if(a.indexOf(s)>-1){const h=a.indexOf(s)+s.length;return a.substring(0,h)+a.substring(h,h+6)}}catch(s){console.error(s)}return a}),axisLabel:{fontSize:8}},series:[{name:o,type:"bar",data:k.value.map(a=>a[l]),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:a=>b(a.name||a.data.repoUrl+"/"+a.data.branchName)},barMaxWidth:25}]}});return(l,o)=>{const a=L;return x(),N(a,{option:i(p),autoresize:""},null,8,["option"])}}},$=F(et,[["__scopeId","data-v-bf823a8c"]]),at=T({__name:"RankingCard",props:{title:{type:String},metric:{type:String,default:"effectives"},ranking:{type:Array,default:[]}},setup(j){const n=D(),{rankColor:b}=Y(),f=j,g=y(()=>f.metric),k=y(()=>n.t(g.value)),p=y(()=>{const o=[...f.ranking||[]],a=g.value;return o.sort((s,h)=>(h[a]||0)-(s[a]||0)).slice(0,10)}),l=y(()=>({title:{text:f.title,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:o=>{const a=o[0],s=p.value[a.dataIndex]||{};return`
          <div>
            <strong>${s.nickname}</strong><br/>
            ${n.t("commits")}: ${s.commits}<br/>
            ${n.t("additions")}: <span style="color:green">${s.additions}</span><br/>
            ${n.t("deletions")}: <span style="color:red">${s.deletions}</span><br/>
            ${n.t("effectives")}: <span style="color:teal">${s.effectives}</span>
          </div>`}},grid:{left:100,right:40,top:80,bottom:40},xAxis:{type:"value",axisLabel:{fontSize:13}},yAxis:{type:"category",inverse:!0,axisLabel:{fontSize:10},data:p.value.map(o=>o.nickname||"")},series:[{name:k.value,type:"bar",barMaxWidth:25,data:p.value.map(o=>o[g.value]||0),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:o=>b(o.dataIndex,p.value.length)}}]}));return(o,a)=>{const s=L;return x(),N(s,{option:i(l),autoresize:""},null,8,["option"])}}}),R=Object.assign(at,{__name:"AynalisisRankingCard"}),nt={class:"w-full h-full flex flex-col justify-center items-center p-4"},st={class:"w-full content-center"},ot={class:"max-w-[1600px] flex flex-row content-center"},rt={__name:"index",setup(j){const n=K(),b=d([]),f=d([]),g=d([]),k=d([]),p=d([]),l=d([]),o=d([]),a=d([]),s=d([]),h=d([]),O=d([]),P=d([]);function v(e){const r="YYYY-MM-DD",c=tt();switch(e){case"today":return[c.startOf("day").format(r),c.endOf("day").format(r)];case"yesterday":return[c.clone().subtract(1,"day").startOf("day").format(r),c.clone().subtract(1,"day").endOf("day").format(r)];case"week":return[c.startOf("week").format(r),c.endOf("week").format(r)];case"lastWeek":return[c.clone().subtract(1,"week").startOf("week").format(r),c.clone().subtract(1,"week").endOf("week").format(r)];case"month":return[c.startOf("month").format(r),c.endOf("month").format(r)];case"lastMonth":return[c.clone().subtract(1,"month").startOf("month").format(r),c.clone().subtract(1,"month").endOf("month").format(r)];default:return[]}}const q=()=>{const[e,r]=v("today"),[c,w]=v("yesterday"),[B,C]=v("week"),[W,U]=v("lastWeek"),[A,z]=v("month"),[I,V]=v("lastMonth");n.getRepoBranches({since:e,until:r}).then(t=>{t.code===200&&(b.value=t.data||[])}),n.getRanking({since:e,until:r}).then(t=>{t.code===200&&(f.value=t.data||[])}),n.getRepoBranches({since:c,until:w}).then(t=>{t.code===200&&(g.value=t.data||[])}),n.getRanking({since:c,until:w}).then(t=>{t.code===200&&(k.value=t.data||[])}),n.getRepoBranches({since:B,until:C}).then(t=>{t.code===200&&(p.value=t.data||[])}),n.getRanking({since:B,until:C}).then(t=>{t.code===200&&(l.value=t.data||[])}),n.getRepoBranches({since:W,until:U}).then(t=>{t.code===200&&(o.value=t.data||[])}),n.getRanking({since:W,until:U}).then(t=>{t.code===200&&(a.value=t.data||[])}),n.getRepoBranches({since:A,until:z}).then(t=>{t.code===200&&(s.value=t.data||[])}),n.getRanking({since:A,until:z}).then(t=>{t.code===200&&(h.value=t.data||[])}),n.getRepoBranches({since:I,until:V}).then(t=>{t.code===200&&(O.value=t.data||[])}),n.getRanking({since:I,until:V}).then(t=>{t.code===200&&(P.value=t.data||[])})},M=d(),_=d(!0);return G(()=>{q(),M.value=E(()=>{_.value&&q()},3e4)}),H(()=>{clearInterval(M.value)}),(e,r)=>{const c=X;return x(),J(Z,null,[S("div",nt,[u(c,{class:"text-xs ml-auto mr-32",dense:"",modelValue:i(_),"onUpdate:modelValue":r[0]||(r[0]=w=>Q(_)?_.value=w:null),label:e.$t("autoRefresh")},null,8,["modelValue","label"])]),S("div",st,[S("div",ot,[u($,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.todayProjects"),projects:i(b)},null,8,["class","title","projects"]),u(R,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.todayRanking"),ranking:i(f)},null,8,["class","title","ranking"]),u($,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.yesterdayProjects"),projects:i(g)},null,8,["class","title","projects"]),u(R,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.yesterdayRanking"),ranking:i(k)},null,8,["class","title","ranking"]),u($,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.weekProjects"),projects:i(p)},null,8,["class","title","projects"]),u(R,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.weekRanking"),ranking:i(l)},null,8,["class","title","ranking"]),u($,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.lastWeekProjects"),projects:i(o)},null,8,["class","title","projects"]),u(R,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.lastWeekRanking"),ranking:i(a)},null,8,["class","title","ranking"]),u($,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.monthProjects"),projects:i(s)},null,8,["class","title","projects"]),u(R,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.monthRanking"),ranking:i(h)},null,8,["class","title","ranking"]),u($,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.lastMonthProjects"),projects:i(O)},null,8,["class","title","projects"]),u(R,{class:m(e.$q.screen.gt.sm?"card":"card-mobile"),title:e.$t("dashboard.lastMonthRanking"),ranking:i(P)},null,8,["class","title","ranking"])])])],64)}}},mt=F(rt,[["__scopeId","data-v-a5f6e662"]]);export{mt as default};
