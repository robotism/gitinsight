import{_ as I,u as V}from"./C0FsRwGL.js";import{e as z,f as k,g as D,o as _,h as u,i as Y,r as p,j as H,k as K,c as T,a as q,b as f}from"#entry";import{_ as L}from"./DlAUqK2U.js";import{h as E}from"./BLMuvzoS.js";const N=()=>({hashColor:l=>{let a=0;for(let h=0;h<l.length;h++)a=l.charCodeAt(h)+((a<<5)-a);return`hsl(${Math.abs(a)%360}, 70%, 55%)`},rankColor:(l,a)=>{const m=["#FFB300","#FFC107","#FFD700"],h="#60A5FA",g=["#FF7043","#F44336","#D32F2F"];return l<3?m[l]:a>0&&l>=a-3?g[l-(a-3)]:h}}),G={__name:"AynalisisProjectsCard",props:{title:{type:String},projects:{type:Array,required:!0},metric:{type:String,default:"effectives"}},setup(j){const e=z(),{hashColor:l}=N(),a=j,m=k(()=>(a.projects||[]).map(c=>({repoBranch:((c.repoUrl||"")?.split("/").pop().replace(".git","")||c.repoUrl)+"/"+c.branchName,...c}))),h=k(()=>{const c=[...m.value],o=a.metric;return c.sort((n,d)=>(d[o]||0)-(n[o]||0))}),g=k(()=>{const c=a.metric,o=e.t(c);return{title:{text:`${a.title}`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:100,right:40,top:60,bottom:30},xAxis:{type:"value",axisLabel:{formatter:"{value}"}},yAxis:{type:"category",inverse:!0,data:h.value.map(n=>n.repoBranch),axisLabel:{fontSize:8}},series:[{name:o,type:"bar",data:h.value.map(n=>n[c]),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:n=>l(n.name||n.data.repoUrl+"/"+n.data.branchName)},barMaxWidth:25}]}});return(c,o)=>{const n=I;return _(),D(n,{option:u(g),autoresize:""},null,8,["option"])}}},b=L(G,[["__scopeId","data-v-193d53b2"]]),J=Y({__name:"RankingCard",props:{title:{type:String},metric:{type:String,default:"effectives"},ranking:{type:Array,default:[]}},setup(j){const e=z(),{rankColor:l}=N(),a=j,m=k(()=>a.metric),h=k(()=>e.t(m.value)),g=k(()=>{const o=[...a.ranking||[]],n=m.value;return o.sort((d,R)=>(R[n]||0)-(d[n]||0)).slice(0,10)}),c=k(()=>({title:{text:a.title,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:o=>{const n=o[0],d=g.value[n.dataIndex]||{};return`
          <div>
            <strong>${d.nickname}</strong><br/>
            ${e.t("commits")}: ${d.commits}<br/>
            ${e.t("additions")}: <span style="color:green">${d.additions}</span><br/>
            ${e.t("deletions")}: <span style="color:red">${d.deletions}</span><br/>
            ${e.t("effectives")}: <span style="color:teal">${d.effectives}</span>
          </div>`}},grid:{left:100,right:40,top:80,bottom:40},xAxis:{type:"value",axisLabel:{fontSize:13}},yAxis:{type:"category",inverse:!0,axisLabel:{fontSize:10},data:g.value.map(o=>o.nickname||"")},series:[{name:h.value,type:"bar",barMaxWidth:25,data:g.value.map(o=>o[m.value]||0),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:o=>l(o.dataIndex,g.value.length)}}]}));return(o,n)=>{const d=I;return _(),D(d,{option:u(c),autoresize:""},null,8,["option"])}}}),v=Object.assign(J,{__name:"AynalisisRankingCard"}),Q=globalThis.setInterval,X={class:"w-full content-center"},Z={class:"max-w-[1600px] flex flex-row content-center"},tt={__name:"index",setup(j){const e=V(),l=p([]),a=p([]),m=p([]),h=p([]),g=p([]),c=p([]),o=p([]),n=p([]),d=p([]),R=p([]),$=p([]),w=p([]);function y(s){const r="YYYY-MM-DD HH:mm:ss",i=E();switch(s){case"today":return[i.startOf("day").format(r),i.endOf("day").format(r)];case"yesterday":return[i.clone().subtract(1,"day").startOf("day").format(r),i.clone().subtract(1,"day").endOf("day").format(r)];case"week":return[i.startOf("week").format(r),i.endOf("week").format(r)];case"lastWeek":return[i.clone().subtract(1,"week").startOf("week").format(r),i.clone().subtract(1,"week").endOf("week").format(r)];case"month":return[i.startOf("month").format(r),i.endOf("month").format(r)];case"lastMonth":return[i.clone().subtract(1,"month").startOf("month").format(r),i.clone().subtract(1,"month").endOf("month").format(r)];default:return[]}}const S=()=>{const[s,r]=y("today"),[i,C]=y("yesterday"),[P,M]=y("week"),[B,O]=y("lastWeek"),[A,F]=y("month"),[W,U]=y("lastMonth");e.getRepoBranches({since:s,until:r}).then(t=>{t.code===200&&(l.value=t.data)}),e.getRanking({since:s,until:r}).then(t=>{t.code===200&&(a.value=t.data)}),e.getRepoBranches({since:i,until:C}).then(t=>{t.code===200&&(m.value=t.data)}),e.getRanking({since:i,until:C}).then(t=>{t.code===200&&(h.value=t.data)}),e.getRepoBranches({since:P,until:M}).then(t=>{t.code===200&&(g.value=t.data)}),e.getRanking({since:P,until:M}).then(t=>{t.code===200&&(c.value=t.data)}),e.getRepoBranches({since:B,until:O}).then(t=>{t.code===200&&(o.value=t.data)}),e.getRanking({since:B,until:O}).then(t=>{t.code===200&&(n.value=t.data)}),e.getRepoBranches({since:A,until:F}).then(t=>{t.code===200&&(d.value=t.data)}),e.getRanking({since:A,until:F}).then(t=>{t.code===200&&(R.value=t.data)}),e.getRepoBranches({since:W,until:U}).then(t=>{t.code===200&&($.value=t.data)}),e.getRanking({since:W,until:U}).then(t=>{t.code===200&&(w.value=t.data)})},x=p(null);return H(()=>{S(),x.value=Q(()=>{S()},3e4)}),K(()=>{clearInterval(x.value)}),(s,r)=>(_(),T("div",X,[q("div",Z,[f(b,{class:"card",title:s.$t("dashboard.todayProjects"),projects:u(l)},null,8,["title","projects"]),f(v,{class:"card",title:s.$t("dashboard.todayRanking"),ranking:u(a)},null,8,["title","ranking"]),f(b,{class:"card",title:s.$t("dashboard.yesterdayProjects"),projects:u(m)},null,8,["title","projects"]),f(v,{class:"card",title:s.$t("dashboard.yesterdayRanking"),ranking:u(h)},null,8,["title","ranking"]),f(b,{class:"card",title:s.$t("dashboard.weekProjects"),projects:u(g)},null,8,["title","projects"]),f(v,{class:"card",title:s.$t("dashboard.weekRanking"),ranking:u(c)},null,8,["title","ranking"]),f(b,{class:"card",title:s.$t("dashboard.lastWeekProjects"),projects:u(o)},null,8,["title","projects"]),f(v,{class:"card",title:s.$t("dashboard.lastWeekRanking"),ranking:u(n)},null,8,["title","ranking"]),f(b,{class:"card",title:s.$t("dashboard.monthProjects"),projects:u(d)},null,8,["title","projects"]),f(v,{class:"card",title:s.$t("dashboard.monthRanking"),ranking:u(R)},null,8,["title","ranking"]),f(b,{class:"card",title:s.$t("dashboard.lastMonthProjects"),projects:u($)},null,8,["title","projects"]),f(v,{class:"card",title:s.$t("dashboard.lastMonthRanking"),ranking:u(w)},null,8,["title","ranking"])])]))}},st=L(tt,[["__scopeId","data-v-e794b691"]]);export{st as default};
