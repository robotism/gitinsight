import{_ as z,u as N}from"./C0FsRwGL.js";import{e as I,f as k,g as D,o as _,h as u,i as V,r as p,j as Y,k as H,c as K,a as T,b as f}from"#entry";import{_ as q}from"./DlAUqK2U.js";import{h as E}from"./BLMuvzoS.js";const L=()=>({hashColor:l=>{let n=0;for(let h=0;h<l.length;h++)n=l.charCodeAt(h)+((n<<5)-n);return`hsl(${Math.abs(n)%360}, 70%, 55%)`},rankColor:(l,n)=>{const m=["#FFB300","#FFC107","#FFD700"],h="#60A5FA",g=["#FF7043","#F44336","#D32F2F"];return l<3?m[l]:n>0&&l>=n-3?g[l-(n-3)]:h}}),G={__name:"AynalisisProjectsCard",props:{title:{type:String},projects:{type:Array,required:!0},metric:{type:String,default:"effectives"}},setup(j){const e=I(),{hashColor:l}=L(),n=j,m=k(()=>(n.projects||[]).map(i=>({repoBranch:((i.repoUrl||"")?.split("/").pop().replace(".git","")||i.repoUrl)+"/"+i.branchName,...i}))),h=k(()=>{const i=[...m.value],o=n.metric;return i.sort((a,d)=>(d[o]||0)-(a[o]||0))}),g=k(()=>{const i=n.metric,o=e.t(i);return{title:{text:`${n.title}`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:100,right:40,top:60,bottom:30},xAxis:{type:"value",axisLabel:{formatter:"{value}"}},yAxis:{type:"category",inverse:!0,data:h.value.map(a=>a.repoBranch),axisLabel:{fontSize:8}},series:[{name:o,type:"bar",data:h.value.map(a=>a[i]),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:a=>l(a.name||a.data.repoUrl+"/"+a.data.branchName)},barMaxWidth:25}]}});return(i,o)=>{const a=z;return _(),D(a,{option:u(g),autoresize:""},null,8,["option"])}}},b=q(G,[["__scopeId","data-v-6bf4de0c"]]),J=V({__name:"RankingCard",props:{title:{type:String},metric:{type:String,default:"effectives"},ranking:{type:Array,default:[]}},setup(j){const e=I(),{rankColor:l}=L(),n=j,m=k(()=>n.metric),h=k(()=>e.t(m.value)),g=k(()=>{const o=[...n.ranking||[]],a=m.value;return o.sort((d,R)=>(R[a]||0)-(d[a]||0)).slice(0,10)}),i=k(()=>({title:{text:n.title,left:"center",textStyle:{fontSize:18,fontWeight:"bold"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:o=>{const a=o[0],d=g.value[a.dataIndex]||{};return`
          <div>
            <strong>${d.nickname}</strong><br/>
            ${e.t("commits")}: ${d.commits}<br/>
            ${e.t("additions")}: <span style="color:green">${d.additions}</span><br/>
            ${e.t("deletions")}: <span style="color:red">${d.deletions}</span><br/>
            ${e.t("effectives")}: <span style="color:teal">${d.effectives}</span>
          </div>`}},grid:{left:100,right:40,top:80,bottom:40},xAxis:{type:"value",axisLabel:{fontSize:13}},yAxis:{type:"category",inverse:!0,axisLabel:{fontSize:10},data:g.value.map(o=>o.nickname||"")},series:[{name:h.value,type:"bar",barMaxWidth:25,data:g.value.map(o=>o[m.value]||0),label:{show:!0,position:"right",formatter:"{c}"},itemStyle:{color:o=>l(o.dataIndex,g.value.length)}}]}));return(o,a)=>{const d=z;return _(),D(d,{class:"w-full h-[400px] border border-gray-200 m-1",option:u(i),autoresize:""},null,8,["option"])}}}),v=Object.assign(J,{__name:"AynalisisRankingCard"}),Q=globalThis.setInterval,X={class:"w-full content-center"},Z={class:"max-w-[1600px] flex flex-row content-center"},ot={__name:"index",setup(j){const e=N(),l=p([]),n=p([]),m=p([]),h=p([]),g=p([]),i=p([]),o=p([]),a=p([]),d=p([]),R=p([]),$=p([]),w=p([]);function y(r){const s="YYYY-MM-DD HH:mm:ss",c=E();switch(r){case"today":return[c.startOf("day").format(s),c.endOf("day").format(s)];case"yesterday":return[c.clone().subtract(1,"day").startOf("day").format(s),c.clone().subtract(1,"day").endOf("day").format(s)];case"week":return[c.startOf("week").format(s),c.endOf("week").format(s)];case"lastWeek":return[c.clone().subtract(1,"week").startOf("week").format(s),c.clone().subtract(1,"week").endOf("week").format(s)];case"month":return[c.startOf("month").format(s),c.endOf("month").format(s)];case"lastMonth":return[c.clone().subtract(1,"month").startOf("month").format(s),c.clone().subtract(1,"month").endOf("month").format(s)];default:return[]}}const S=()=>{const[r,s]=y("today"),[c,C]=y("yesterday"),[P,M]=y("week"),[B,O]=y("lastWeek"),[A,F]=y("month"),[W,U]=y("lastMonth");e.getRepoBranches({since:r,until:s}).then(t=>{t.code===200&&(l.value=t.data)}),e.getRanking({since:r,until:s}).then(t=>{t.code===200&&(n.value=t.data)}),e.getRepoBranches({since:c,until:C}).then(t=>{t.code===200&&(m.value=t.data)}),e.getRanking({since:c,until:C}).then(t=>{t.code===200&&(h.value=t.data)}),e.getRepoBranches({since:P,until:M}).then(t=>{t.code===200&&(g.value=t.data)}),e.getRanking({since:P,until:M}).then(t=>{t.code===200&&(i.value=t.data)}),e.getRepoBranches({since:B,until:O}).then(t=>{t.code===200&&(o.value=t.data)}),e.getRanking({since:B,until:O}).then(t=>{t.code===200&&(a.value=t.data)}),e.getRepoBranches({since:A,until:F}).then(t=>{t.code===200&&(d.value=t.data)}),e.getRanking({since:A,until:F}).then(t=>{t.code===200&&(R.value=t.data)}),e.getRepoBranches({since:W,until:U}).then(t=>{t.code===200&&($.value=t.data)}),e.getRanking({since:W,until:U}).then(t=>{t.code===200&&(w.value=t.data)})},x=p(null);return Y(()=>{S(),x.value=Q(()=>{S()},3e4)}),H(()=>{clearInterval(x.value)}),(r,s)=>(_(),K("div",X,[T("div",Z,[f(b,{title:r.$t("dashboard.todayProjects"),projects:u(l)},null,8,["title","projects"]),f(v,{title:r.$t("dashboard.todayRanking"),ranking:u(n)},null,8,["title","ranking"]),f(b,{title:r.$t("dashboard.yesterdayProjects"),projects:u(m)},null,8,["title","projects"]),f(v,{title:r.$t("dashboard.yesterdayRanking"),ranking:u(h)},null,8,["title","ranking"]),f(b,{title:r.$t("dashboard.weekProjects"),projects:u(g)},null,8,["title","projects"]),f(v,{title:r.$t("dashboard.weekRanking"),ranking:u(i)},null,8,["title","ranking"]),f(b,{title:r.$t("dashboard.lastWeekProjects"),projects:u(o)},null,8,["title","projects"]),f(v,{title:r.$t("dashboard.lastWeekRanking"),ranking:u(a)},null,8,["title","ranking"]),f(b,{title:r.$t("dashboard.monthProjects"),projects:u(d)},null,8,["title","projects"]),f(v,{title:r.$t("dashboard.monthRanking"),ranking:u(R)},null,8,["title","ranking"]),f(b,{title:r.$t("dashboard.lastMonthProjects"),projects:u($)},null,8,["title","projects"]),f(v,{title:r.$t("dashboard.lastMonthRanking"),ranking:u(w)},null,8,["title","ranking"])])]))}};export{ot as default};
